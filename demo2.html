<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Arrow Connection</title>
    <style>
        .table-wrapper {
            display: inline-block;
            width: 300px;
            height: 400px;
            overflow: auto;
            border: 1px solid #ccc;
            margin: 10px;
        }

        table {
            border-collapse: collapse;
            width: 100%;
        }

        td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: center;
        }

        .draggable-row {
            background-color: #e0f7fa;
            cursor: grab;
        }

        .droppable-row {
            background-color: #fce4ec;
        }

        svg {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="table-wrapper" id="table1">
        <table>
            <tr class="draggable-row" draggable="true">
                <td>Row 1</td>
            </tr>
            <tr class="draggable-row" draggable="true">
                <td>Row 2</td>
            </tr>
            <tr class="draggable-row" draggable="true">
                <td>Row 3</td>
            </tr>
        </table>
    </div>

    <div class="table-wrapper" id="table2">
        <table>
            <tr class="droppable-row">
                <td>Target 1</td>
            </tr>
            <tr class="droppable-row">
                <td>Target 2</td>
            </tr>
            <tr class="droppable-row">
                <td>Target 3</td>
            </tr>
        </table>
    </div>

    <svg id="connection-lines" width="100%" height="100%">
        <defs>
            <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
                <polygon points="0 0, 10 3.5, 0 7" fill="black" />
            </marker>
        </defs>
    </svg>

    <script>
        const connectionLines = document.getElementById('connection-lines');
        let dragSource = null;
        let currentLine = null;

        function createArrowLine(x1, y1, x2, y2) {
            const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            line.setAttribute('x1', x1);
            line.setAttribute('y1', y1);
            line.setAttribute('x2', x2);
            line.setAttribute('y2', y2);
            line.setAttribute('stroke', 'black');
            line.setAttribute('stroke-width', '2');
            line.setAttribute('marker-end', 'url(#arrowhead)');
            connectionLines.appendChild(line);
            return line;
        }

        function updateArrowLine(line, x1, y1, x2, y2) {
            const dx = x2 - x1;
            const dy = y2 - y1;
            const distance = Math.sqrt(dx * dx + dy * dy);

            const arrowLength = Math.min(distance - 10, distance); // Avoid overshooting
            const angle = Math.atan2(dy, dx);

            const adjustedX2 = x1 + arrowLength * Math.cos(angle);
            const adjustedY2 = y1 + arrowLength * Math.sin(angle);

            line.setAttribute('x1', x1);
            line.setAttribute('y1', y1);
            line.setAttribute('x2', adjustedX2);
            line.setAttribute('y2', adjustedY2);
        }

        function getRowCenterPosition(row) {
            const rect = row.getBoundingClientRect();
            return {
                x: rect.left + rect.width / 2 + window.scrollX,
                y: rect.top + rect.height / 2 + window.scrollY
            };
        }

        document.querySelectorAll('.draggable-row').forEach(row => {
            row.addEventListener('dragstart', (event) => {
                dragSource = event.target;
                const position = getRowCenterPosition(dragSource);
                currentLine = createArrowLine(position.x, position.y, position.x, position.y);
            });
        });

        document.querySelectorAll('.droppable-row').forEach(row => {
            row.addEventListener('dragover', (event) => {
                event.preventDefault();
            });

            row.addEventListener('drop', (event) => {
                event.preventDefault();
                const targetRow = event.target.closest('.droppable-row');

                if (targetRow && targetRow !== dragSource) {
                    const sourcePosition = getRowCenterPosition(dragSource);
                    const targetPosition = getRowCenterPosition(targetRow);
                    updateArrowLine(currentLine, sourcePosition.x, sourcePosition.y, targetPosition.x, targetPosition.y);

                    currentLine._sourceRow = dragSource;
                    currentLine._targetRow = targetRow;
                }
            });
        });

        document.querySelectorAll('.table-wrapper').forEach(wrapper => {
            wrapper.addEventListener('scroll', () => {
                const lines = connectionLines.querySelectorAll('line');
                lines.forEach(line => {
                    const sourcePosition = getRowCenterPosition(line._sourceRow);
                    const targetPosition = getRowCenterPosition(line._targetRow);
                    updateArrowLine(line, sourcePosition.x, sourcePosition.y, targetPosition.x, targetPosition.y);
                });
            });
        });
    </script>
</body>
</html>
